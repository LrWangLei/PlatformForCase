/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2017-09-11 03:33:53 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.UpdataCase;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.sql.*;
import java.util.*;
import java.io.*;
import com.talk51.Utils.JDBCConnectionPool;

public final class UpdataStep1_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\r\n");
      out.write("<html>\r\n");
      out.write("<head>\r\n");
      out.write("<link rel=\"stylesheet\" type=\"text/css\" href=\"../css/updatastep1.css\">\r\n");
      out.write("<script src=\"../js/jquery-3.1.0.min.js\"></script>\r\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; UTF-8\">\r\n");
      out.write("<title>修改测试用例</title>\r\n");

request.setCharacterEncoding("UTF-8");
int user_id=0;
if(session.getAttribute("userid")==null)
	{

      out.write("\r\n");
      out.write("<script language=javascript>\r\n");
      out.write("alert(\"您尚未登陆或者登陆信息已失效，请重新登陆\")\r\n");
      out.write("</script>\r\n");

	response.sendRedirect("../index.html");
	return;
	}
else
	{
	Object O=session.getAttribute("userid");
	user_id=Integer.parseInt(O==null?"":O.toString());
	}


      out.write("\r\n");
      out.write("</head>\r\n");
      out.write("<body>\r\n");
      out.write("<div>\r\n");
      out.write("请选择测试用例所属模块<br>\r\n");
      out.write("选择模块：<br><SELECT name=\"ModelSelect\" id=\"model_name\">\r\n");
      out.write("<OPTION value=\"default\" selected>请选择...</OPTION>\r\n");

Connection connection=JDBCConnectionPool.getConnection();
Statement statement = connection.createStatement();
String sql="SELECT distinct model_name FROM interface_list";
ResultSet rs = statement.executeQuery (sql);
while(rs.next())
{

      out.write("\r\n");
      out.write("<OPTION value=\"");
      out.print(rs.getString("model_name"));
      out.write('"');
      out.write('>');
      out.print(rs.getString("model_name"));
      out.write("</OPTION>\r\n");

}
JDBCConnectionPool.close(rs, statement);

      out.write("\r\n");
      out.write("</SELECT><br>\r\n");
      out.write("</div>\r\n");
      out.write("<div>\r\n");
      out.write("优先级\r\n");
      out.write("<SELECT name=\"prority_select\" id=\"prority\">\r\n");
      out.write("<OPTION value=\"1\" selected>1</OPTION>\r\n");
      out.write("<OPTION value=\"2\" >2</OPTION>\r\n");
      out.write("<OPTION value=\"3\" >3</OPTION>\r\n");
      out.write("<OPTION value=\"10\">10</OPTION>\r\n");
      out.write("<OPTION value=\"1,2,3,10\" >全部</OPTION>\r\n");
      out.write("</SELECT>\r\n");
      out.write("<input type=\"button\" value=\"刷新\" onclick=\"refresh()\">\r\n");
      out.write("</div>\r\n");
      out.write("<div id=\"case_list\">\r\n");
      out.write("请选择模块\r\n");
      out.write("</div>\r\n");
      out.write("<div>\r\n");
      out.write("<!--<input type=\"button\" value=\"批量运行所选择用例_旧方法\" onclick=\"testselected()\">-->\r\n");
      out.write("<input type=\"button\" value=\"批量运行所选择用例\" onclick=\"testselected_new()\">\r\n");
      out.write("<input type=\"button\" value=\"批量删除所选择用例\" onclick=\"deleteselected()\">\r\n");
      out.write("<input type=\"button\" value=\"全选\" onclick=\"selectall()\">\r\n");
      out.write("<input type=\"button\" value=\"取消全选\" onclick=\"unselectall()\">\r\n");
      out.write("<input type=\"button\" value=\"刷新\" onclick=\"refresh()\">\r\n");
      out.write("</div>\r\n");
      out.write("<div>\r\n");
      out.write("如果需要在用例保存之外的环境运行用例，请选择<br>\r\n");
      out.write("已有环境：<SELECT name=\"ip\" id=\"ip_another\">\r\n");
      out.write("<OPTION value=\"none\" selected>&lt;使用用例本身IP地址&gt;</OPTION>\r\n");

Connection connection2=JDBCConnectionPool.getConnection();
Statement statement2 = connection2.createStatement();
String sql2="SELECT * FROM interface_ip";
ResultSet rs2 = statement2.executeQuery (sql2);
while(rs2.next())
{

      out.write("\r\n");
      out.write("<OPTION value=\"");
      out.print(rs2.getString("ip"));
      out.write(':');
      out.print(rs2.getString("port"));
      out.write('"');
      out.write('>');
      out.print(rs2.getString("ip"));
      out.write(':');
      out.print(rs2.getString("port"));
      out.write("</OPTION>\r\n");

}
rs2.close(); 
statement2.close(); 
connection2.close(); 

      out.write("\r\n");
      out.write("</SELECT>\r\n");
      out.write("<br>\r\n");
      out.write("</div>\r\n");
      out.write("<form id=\"try\" action=\"../Tool/Result.jsp\" method=\"post\" target=\"_blank\">\r\n");
      out.write("<input id=\"result_try\" name=\"result\"  type=\"hidden\" />\r\n");
      out.write("</form>\r\n");
      out.write("</body>\r\n");
      out.write("<script language=javascript>\r\n");
      out.write("var userid=");
      out.print(user_id);
      out.write("\r\n");
      out.write("\r\n");
      out.write("$(document).ready(\r\n");
      out.write("\t$(\"#model_name\").change(\r\n");
      out.write("\t\tfunction(){\r\n");
      out.write("\t\t\trefresh();\r\n");
      out.write("\t}))\r\n");
      out.write("\r\n");
      out.write("    $(\"#prority\").change(\r\n");
      out.write("\t\tfunction(){\r\n");
      out.write("\t\t\trefresh();\r\n");
      out.write("\t})\r\n");
      out.write("\r\n");
      out.write("//function getcaseids(){\r\n");
      out.write("//  var chk_value =[];\r\n");
      out.write("//  var\tresult=\"\";\r\n");
      out.write("//  var anotherip=$(\"#ip_another option:selected\").val();\r\n");
      out.write("//  $('input[name=\"select\"]:checked').each(function(){\r\n");
      out.write("//\t  result=result+($(this).val())+\",\";\r\n");
      out.write("//  });\r\n");
      out.write("//\r\n");
      out.write("//  if(result==\"\")\r\n");
      out.write("//\t  {\r\n");
      out.write("//\t  alert(\"您没有选择任何用例\");\r\n");
      out.write("//\t  return false\r\n");
      out.write("//\t  }\r\n");
      out.write("//\t$.post(\"../runmuilttest\",\r\n");
      out.write("//\t\t\t{preids:result,another_ip:anotherip},\r\n");
      out.write("//\t\t\tfunction(data)\r\n");
      out.write("//\t\t\t\t{\r\n");
      out.write("//\t\t\t\t\tsendresult(data);\r\n");
      out.write("//\t\t\t\t}\r\n");
      out.write("//\t\t\t)\r\n");
      out.write("//}\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("function deleteselected() {\r\n");
      out.write("    var ids = \"\";\r\n");
      out.write("    var r=confirm(\"是否真的删除？\");\r\n");
      out.write("    if (r==true){\r\n");
      out.write("      $('input[name=\"select\"]:checked').each(function(){\r\n");
      out.write("          if (ids == \"\") {\r\n");
      out.write("              ids = $(this).val();\r\n");
      out.write("          } else {\r\n");
      out.write("              ids = ids + \",\" + $(this).val();\r\n");
      out.write("          }\r\n");
      out.write("      });\r\n");
      out.write("    }else{\r\n");
      out.write("      return false;\r\n");
      out.write("    }\r\n");
      out.write("\tif(ids == \"\"){\r\n");
      out.write("\t    alert(\"您没有选择任何用例\");\r\n");
      out.write("\t\treturn false\r\n");
      out.write("\t}\r\n");
      out.write("\t$.post(\r\n");
      out.write("\t    \"../batchDelCases\",\r\n");
      out.write("        {preids:ids},\r\n");
      out.write("        function(data){\r\n");
      out.write("        if(data == \"error\"){\r\n");
      out.write("            alert(\"删除失败！\");\r\n");
      out.write("        } else {\r\n");
      out.write("            alert(\"删除成功！\");\r\n");
      out.write("            location.reload();\r\n");
      out.write("        }\r\n");
      out.write("    })\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("function getcaseids_new(){\r\n");
      out.write("\t  var chk_value =[];\r\n");
      out.write("\t  var\tresult=\"\";\r\n");
      out.write("\t  var anotherip=$(\"#ip_another option:selected\").val();\r\n");
      out.write("\t  $('input[name=\"select\"]:checked').each(function(){\r\n");
      out.write("\t\t  result=result+($(this).val())+\",\";\r\n");
      out.write("\t  });\r\n");
      out.write("\t  \r\n");
      out.write("\t  if(result==\"\")\r\n");
      out.write("\t\t  {\r\n");
      out.write("\t\t  alert(\"您没有选择任何用例\");\r\n");
      out.write("\t\t  return false\r\n");
      out.write("\t\t  }\r\n");
      out.write("\t\t$.post(\"../runmuilttest_new\",\r\n");
      out.write("\t\t\t\t{preids:result,another_ip:anotherip},\r\n");
      out.write("\t\t\t\tfunction(data)\r\n");
      out.write("\t\t\t\t\t{\r\n");
      out.write("\t\t\t\t\tsendresult(data);\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t)\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("function refresh() {\r\n");
      out.write("    var getinfo=$(\"#model_name option:selected\").val();\r\n");
      out.write("    var getprority=$(\"#prority option:selected\").val();\r\n");
      out.write("\r\n");
      out.write("    if(getinfo==\"default\"){\r\n");
      out.write("        $(\"#case_list\").html(\"请选择模块\");\r\n");
      out.write("    } else {\r\n");
      out.write("        $.post(\"../GetApiListByModelNameAndUserId\",\r\n");
      out.write("            {projectname:getinfo,userid:userid,prority:getprority},\r\n");
      out.write("            function(data){\r\n");
      out.write("                $(\"#case_list\").html(data);\r\n");
      out.write("        })\r\n");
      out.write("    }\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("//function testselected(){\r\n");
      out.write("//\tgetcaseids();\r\n");
      out.write("//}\r\n");
      out.write("\r\n");
      out.write("function testselected_new(){\r\n");
      out.write("\tgetcaseids_new();\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("function sendresult(result)\r\n");
      out.write("{\r\n");
      out.write("\tdocument.getElementById(\"result_try\").value=result;\r\n");
      out.write("\tdocument.getElementById(\"try\").submit();\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("function selectall()\r\n");
      out.write("{\r\n");
      out.write("\tvar box=document.getElementsByName(\"select\");\r\n");
      out.write("\tvar len = box.length; \r\n");
      out.write("\tfor(var i=0; i<len; i++)\r\n");
      out.write("\t\t{\r\n");
      out.write("\t\tbox[i].checked = true; \r\n");
      out.write("\t\t}\r\n");
      out.write("}\r\n");
      out.write("\r\n");
      out.write("function unselectall()\r\n");
      out.write("{\r\n");
      out.write("\tvar box=document.getElementsByName(\"select\");\r\n");
      out.write("\tvar len = box.length; \r\n");
      out.write("\tfor(var i=0; i<len; i++)\r\n");
      out.write("\t\t{\r\n");
      out.write("\t\tbox[i].checked = false; \r\n");
      out.write("\t\t}\r\n");
      out.write("}\r\n");
      out.write("</script>\r\n");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
